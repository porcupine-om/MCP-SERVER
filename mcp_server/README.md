# Product MCP Server

MCP (Model Context Protocol) сервер для работы с базой данных товаров супермаркета.

## Описание

Сервер предоставляет инструменты для работы с SQLite базой данных товаров:
- Просмотр всех товаров
- Поиск товаров по имени, категории или ID
- Добавление новых товаров
- Безопасный калькулятор для вычислений

## Структура проекта

```
mcp_server/
├── server.py          # Основной MCP сервер
├── db.py              # Работа с SQLite базой данных
├── tools.py           # MCP инструменты
├── products.db        # База данных (создается автоматически)
├── requirements.txt   # Зависимости
└── README.md          # Документация
```

## Установка

1. Убедитесь, что у вас установлен Python 3.7 или выше
2. Установите зависимости (если требуется):

```bash
pip install -r requirements.txt
```

Примечание: SQLite3 входит в стандартную библиотеку Python, дополнительные зависимости не требуются.

## Запуск

```bash
python server.py
```

Сервер работает через стандартный ввод/вывод (stdio) и ожидает JSON-RPC запросы в формате MCP.

## Инициализация базы данных

При первом запуске автоматически создается база данных `products.db` и заполняется 100 тестовыми товарами из различных категорий:
- Овощи
- Фрукты
- Молочные продукты
- Мясо и птица
- Хлеб и выпечка
- Напитки
- Крупы и макароны
- Консервы
- Сладости
- Замороженные продукты

## Доступные инструменты

### 1. list_products
Возвращает список всех товаров из базы данных.

**Параметры:** нет

**Пример запроса:**
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/call",
  "params": {
    "name": "list_products",
    "arguments": {}
  }
}
```

### 2. find_product
Ищет товары по имени (частичное совпадение).

**Параметры:**
- `name` (string, обязательный) - название товара для поиска

**Пример запроса:**
```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/call",
  "params": {
    "name": "find_product",
    "arguments": {
      "name": "чай"
    }
  }
}
```

### 3. find_products_by_category
Ищет товары по категории.

**Параметры:**
- `category` (string, обязательный) - категория товаров

**Пример запроса:**
```json
{
  "jsonrpc": "2.0",
  "id": 3,
  "method": "tools/call",
  "params": {
    "name": "find_products_by_category",
    "arguments": {
      "category": "Фрукты"
    }
  }
}
```

### 4. find_product_by_ID
Ищет товар по ID.

**Параметры:**
- `id` (integer, обязательный) - ID товара

**Пример запроса:**
```json
{
  "jsonrpc": "2.0",
  "id": 4,
  "method": "tools/call",
  "params": {
    "name": "find_product_by_ID",
    "arguments": {
      "id": 1
    }
  }
}
```

### 5. add_product
Добавляет новый товар в базу данных.

**Параметры:**
- `name` (string, обязательный) - название товара
- `category` (string, обязательный) - категория товара
- `price` (number, обязательный) - цена товара

**Пример запроса:**
```json
{
  "jsonrpc": "2.0",
  "id": 5,
  "method": "tools/call",
  "params": {
    "name": "add_product",
    "arguments": {
      "name": "Новый товар",
      "category": "Категория",
      "price": 100.0
    }
  }
}
```

### 6. calculate
Безопасный калькулятор для вычисления математических выражений.

**Параметры:**
- `expression` (string, обязательный) - математическое выражение

**Пример запроса:**
```json
{
  "jsonrpc": "2.0",
  "id": 6,
  "method": "tools/call",
  "params": {
    "name": "calculate",
    "arguments": {
      "expression": "2+2*3"
    }
  }
}
```

**Поддерживаемые операции:**
- Сложение (+)
- Вычитание (-)
- Умножение (*)
- Деление (/)
- Возведение в степень (**)
- Остаток от деления (%)
- Целочисленное деление (//)
- Унарные операции (+ и -)

## Формат ответа

Все инструменты возвращают ответ в формате:

```json
{
  "success": true,
  "result": {...},
  "count": 10  // для списков товаров
}
```

В случае ошибки:

```json
{
  "success": false,
  "error": "Описание ошибки"
}
```

## Безопасность

Калькулятор использует AST (Abstract Syntax Tree) для безопасного парсинга выражений вместо `eval()`, что предотвращает выполнение произвольного кода.

## Тестирование

Для тестирования сервера можно использовать стандартный ввод/вывод:

```bash
echo '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}' | python server.py
```

## Лицензия

Проект создан для демонстрации работы MCP сервера.

