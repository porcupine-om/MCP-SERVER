# Telegram Bot для работы с базой данных товаров

Telegram бот, который использует OpenAI для понимания запросов пользователя и взаимодействует с MCP сервером для работы с базой данных товаров.

## Описание

Бот позволяет пользователям работать с базой данных товаров через естественный язык:
- Просмотр всех товаров
- Поиск товаров по имени или категории
- Добавление новых товаров
- Математические вычисления

## Структура проекта

```
telegram_bot/
├── bot.py              # Основной файл бота
├── config.py           # Конфигурация и загрузка .env
├── mcp_client.py        # Клиент для работы с MCP сервером
├── requirements.txt    # Зависимости
├── .env                # Переменные окружения (создать на основе .env.example)
├── .env.example        # Пример файла с переменными окружения
└── README.md           # Документация
```

## Установка

1. Установите зависимости:

```bash
pip install -r requirements.txt
```

2. Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

3. Заполните `.env` файл:
   - `TELEGRAM_API_TOKEN` - токен бота от @BotFather
   - `OPENAI_API_KEY` - API ключ OpenAI (через Proxyapi)
   - Остальные параметры можно оставить по умолчанию

## Запуск

### 1. Запустите MCP HTTP сервер

В директории `mcp_server`:

```bash
cd ../mcp_server
pip install -r requirements.txt  # Установите FastAPI и uvicorn
python http_server.py
```

Сервер запустится на `http://localhost:8000`

### 2. Запустите Telegram бота

В директории `telegram_bot`:

```bash
python bot.py
```

## Использование

После запуска бота отправьте ему команду `/start` или просто напишите запрос:

- "покажи все товары"
- "найди чай"
- "покажи товары в категории Фрукты"
- "добавь товар яблоки 120 фрукт"
- "сколько будет 2+2*3"

## Команды бота

- `/start` - Начать работу с ботом
- `/help` - Показать справку

## Как это работает

1. Пользователь отправляет сообщение боту
2. Бот отправляет запрос в OpenAI (через Proxyapi)
3. LLM анализирует запрос и определяет, нужен ли вызов MCP инструмента
4. Если нужен инструмент, бот вызывает его через HTTP API MCP сервера
5. Результат форматируется и отправляется пользователю

## Требования

- Python 3.7+
- Запущенный MCP HTTP сервер (http_server.py)
- Telegram Bot Token от @BotFather
- OpenAI API Key (через Proxyapi)

## Устранение неполадок

### Бот не отвечает
- Проверьте, что MCP HTTP сервер запущен на `http://localhost:8000`
- Проверьте правильность токена в `.env`
- Проверьте логи бота

### Ошибки подключения к MCP серверу
- Убедитесь, что `http_server.py` запущен
- Проверьте URL в `MCP_SERVER_URL` в `.env`

### Ошибки OpenAI
- Проверьте правильность API ключа
- Убедитесь, что используете правильный URL Proxyapi

